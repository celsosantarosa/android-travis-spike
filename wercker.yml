box: jacekmarchwicki/android
build:
  steps:
    - script:
        name: show base information
        code: |
          uname -a
          echo ANDROID_HOME=$ANDROID_HOME
          echo ANDROID_BUILD_TOOLS=$ANDROID_BUILD_TOOLS
          echo ANDROID_UPDATE_FILTER=$ANDROID_UPDATE_FILTER
          echo ANDROID_EMULATOR_FORCE_32BIT=$ANDROID_EMULATOR_FORCE_32BIT
    - android-sdk-update:
        #filter: addon-google_apis-google-22,sys-img-armeabi-v7a-addon-google_apis-google-22 # Android 5.1.1 ARM with Google APIs
        #filter: sys-img-armeabi-v7a-android-22 # Android 5.1.1 ARM
        #filter: addon-google_apis-google-19 # Android 4.4.4 ARM with Google APIs
        #filter: sys-img-armeabi-v7a-android-19 # Android 4.4.4 ARM
        #filter: sys-img-x86_64-addon-google_apis-google-22 # Android 5.1.1 x86_64 with Google APIs
        #filter: sys-img-x86_64-android-22 # Android 5.1.1 x86_64
        filter: sys-img-x86-android-22 # Android 5.1.1 x86_64
        #filter: addon-google_apis_x86-google-19 # Android 4.4.4 x86 with Google APIs
        #filter: sys-img-x86-android-19 # Android 4.4.4 x86
    - script:
        name: show android targets
        code: |
          android list target
    - setup-android-emulator:
        target: android-22
        abi: x86
        #abi: default/armeabi-v7a
        #abi: google_apis/armeabi-v7a
        #abi: armeabi-v7a
        #abi: x86_64
    - script:
        name: run ./gradlew clean build connectedCheck
        code: |
          ./gradlew --project-cache-dir=$WERCKER_CACHE_DIR clean build connectedCheck
  after-steps:
    - script:
        name: inspect build result
        on: success
        code: |
          ls -al app/build/apk/
          cp app/build/apk/*.apk $WERCKER_REPORT_ARTIFACTS_DIR

